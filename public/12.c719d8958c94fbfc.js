"use strict";(self.webpackChunkng=self.webpackChunkng||[]).push([[12],{7012:(N,c,a)=>{a.r(c),a.d(c,{LoginModule:()=>M});var d=a(6895),o=a(4006),t=a(4650),h=a(1491),f=a(1458),l=a(9299),u=a(4859),p=a(9549),m=a(4144);let _=(()=>{class s{constructor(e,n,r,g){this.fb=e,this.api=n,this.helper=r,this.router=g,this.submitting=!1,this.form=this.fb.group({email:["bonifacepereira@gmail.com",[o.kI.required,o.kI.email]],password:["asdasdasd",[o.kI.required]]}),this.helper.getUser().token&&this.router.navigate(["/"])}ngOnInit(){}submit(){this.form?.invalid?this.form.markAllAsTouched():(this.submitting=!0,this.api.post("auth/login",this.form?.value).subscribe({next:e=>{this.submitting=!1,console.log(e),e.status?(this.helper.setUser(e.data),this.router.navigate(["home"])):this.helper.alert({message:e.message,exception:e.exception})},error:e=>{this.submitting=!1,this.helper.alert({message:e})}}))}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(o.qu),t.Y36(h.s),t.Y36(f.W),t.Y36(l.F0))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-login"]],decls:21,vars:1,consts:[[1,"lc"],[1,"l"],["src","assets/logo.png","alt","",1,"logo"],[1,"head-t",2,"margin-top","36px"],[2,"width","500px",3,"formGroup","submit"],["appearance","outline",1,"mr2",2,"width","300px"],["matInput","","formControlName","email"],["matInput","","formControlName","password"],["type","submit","color","primary","mat-flat-button",""]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t._UZ(2,"img",2),t.TgZ(3,"h1",3),t._uU(4,"Login"),t.qZA(),t.TgZ(5,"p"),t._uU(6," Please enter credentials to log into Gitftp "),t.qZA()(),t.TgZ(7,"div",1)(8,"form",4),t.NdJ("submit",function(){return n.submit()}),t.TgZ(9,"mat-form-field",5)(10,"mat-label"),t._uU(11,"Email"),t.qZA(),t._UZ(12,"input",6),t.qZA(),t._UZ(13,"br"),t.TgZ(14,"mat-form-field",5)(15,"mat-label"),t._uU(16,"Password"),t.qZA(),t._UZ(17,"input",7),t.qZA(),t.TgZ(18,"div")(19,"button",8),t._uU(20," Login "),t.qZA()()()()()),2&e&&(t.xp6(8),t.Q6J("formGroup",n.form))},dependencies:[u.lW,o._Y,o.Fj,o.JJ,o.JL,o.sg,o.u,p.KE,p.hX,m.Nt],styles:[".lc[_ngcontent-%COMP%]{width:100%}.lc[_ngcontent-%COMP%]   .l[_ngcontent-%COMP%]{margin:55px}.lc[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{height:50px;margin-bottom:10px;margin-left:-10px}.lc[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   .head-t[_ngcontent-%COMP%]{margin:0;font-weight:400}"]}),s})();function b(s,i){if(1&s&&(t.TgZ(0,"li"),t._uU(1),t.qZA()),2&s){const e=t.oxw(2);t.xp6(1),t.AsE(" Git: ",e.deps.git[0]," ",null==e.deps?null:e.deps.git[1]," ")}}function Z(s,i){if(1&s&&(t.TgZ(0,"li"),t._uU(1),t.qZA()),2&s){const e=t.oxw(2);t.xp6(1),t.AsE(" Php: ",e.deps.php[0]," ",null==e.deps?null:e.deps.php[1]," ")}}function x(s,i){if(1&s&&(t.TgZ(0,"li"),t._uU(1),t.qZA()),2&s){const e=t.oxw(2);t.xp6(1),t.hij(" OS: ",e.deps.os," ")}}function C(s,i){1&s&&(t.TgZ(0,"li"),t._uU(1," All OK \u{1f44d} "),t.qZA())}function T(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",7),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(2);return t.KtG(r.page="db")}),t._uU(1," Continue "),t.qZA()}}function v(s,i){if(1&s&&(t.TgZ(0,"div",1)(1,"h2"),t._uU(2,"Dependency Check"),t.qZA(),t.TgZ(3,"p"),t._uU(4," Checking if all the required dependencies are met. "),t.qZA(),t.TgZ(5,"ul"),t.YNc(6,b,2,2,"li",5),t.YNc(7,Z,2,2,"li",5),t.YNc(8,x,2,1,"li",5),t.YNc(9,C,2,0,"li",5),t.qZA(),t.YNc(10,T,2,0,"button",6),t.qZA()),2&s){const e=t.oxw();t.xp6(6),t.Q6J("ngIf",e.deps&&e.deps.git),t.xp6(1),t.Q6J("ngIf",e.deps&&e.deps.php),t.xp6(1),t.Q6J("ngIf",e.deps&&e.deps.php),t.xp6(1),t.Q6J("ngIf",e.deps&&e.deps.status),t.xp6(1),t.Q6J("ngIf",e.deps&&e.deps.status)}}function A(s,i){if(1&s&&(t.TgZ(0,"p",19),t._uU(1),t.qZA()),2&s){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.dbMsg," ")}}function U(s,i){1&s&&(t.TgZ(0,"span"),t._uU(1,"ing"),t.qZA())}function q(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"div",1)(1,"h2"),t._uU(2,"Setup MySQL database"),t.qZA(),t.TgZ(3,"p"),t._uU(4," Please enter the credentials for database where you want Gitftp schema to be installed. "),t.qZA(),t._UZ(5,"div",8),t.TgZ(6,"form",9),t.NdJ("submit",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.testDbConnection())}),t.TgZ(7,"mat-form-field",10)(8,"mat-label"),t._uU(9,"Host"),t.qZA(),t._UZ(10,"input",11),t.qZA(),t.TgZ(11,"mat-form-field",10)(12,"mat-label"),t._uU(13,"Database name"),t.qZA(),t._UZ(14,"input",12),t.qZA(),t.TgZ(15,"mat-form-field",10)(16,"mat-label"),t._uU(17,"Username"),t.qZA(),t._UZ(18,"input",13),t.qZA(),t.TgZ(19,"mat-form-field",10)(20,"mat-label"),t._uU(21,"Password"),t.qZA(),t._UZ(22,"input",14),t.qZA(),t.TgZ(23,"mat-form-field",10)(24,"mat-label"),t._uU(25,"Port"),t.qZA(),t._UZ(26,"input",15),t.qZA(),t.TgZ(27,"mat-form-field",10)(28,"mat-label"),t._uU(29,"Unix socket"),t.qZA(),t._UZ(30,"input",16),t.qZA(),t.TgZ(31,"div"),t.YNc(32,A,2,1,"p",17),t.TgZ(33,"button",18),t._uU(34," Test"),t.YNc(35,U,2,0,"span",5),t._uU(36," connection "),t.qZA()()()()}if(2&s){const e=t.oxw();t.xp6(6),t.Q6J("formGroup",e.dbForm),t.xp6(26),t.Q6J("ngIf",e.dbMsg),t.xp6(1),t.Q6J("disabled",e.testingDbConnection),t.xp6(2),t.Q6J("ngIf",e.testingDbConnection)}}function I(s,i){if(1&s&&(t.TgZ(0,"p",26),t._uU(1),t.qZA()),2&s){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.setupProgress,"... ")}}function P(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"div",1)(1,"form",9),t.NdJ("submit",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.setupSubmit())}),t.TgZ(2,"h2"),t._uU(3,"Create admin user"),t.qZA(),t.TgZ(4,"p"),t._uU(5," Please enter new credentials to log into Gitftp "),t.qZA(),t.TgZ(6,"mat-form-field",20)(7,"mat-label"),t._uU(8,"Email"),t.qZA(),t._UZ(9,"input",21),t.qZA(),t._UZ(10,"br"),t.TgZ(11,"mat-form-field",10)(12,"mat-label"),t._uU(13,"Password"),t.qZA(),t._UZ(14,"input",14),t.qZA(),t.TgZ(15,"mat-form-field",10)(16,"mat-label"),t._uU(17,"Confirm password"),t.qZA(),t._UZ(18,"input",22),t.qZA(),t.TgZ(19,"h2"),t._uU(20,"Site"),t.qZA(),t.TgZ(21,"mat-form-field",23)(22,"mat-label"),t._uU(23,"Public domain"),t.qZA(),t._UZ(24,"input",24),t.qZA(),t.TgZ(25,"div"),t.YNc(26,I,2,1,"p",25),t.TgZ(27,"button",18),t._uU(28," Start setup "),t.qZA()()()()}if(2&s){const e=t.oxw();t.xp6(1),t.Q6J("formGroup",e.userForm),t.xp6(25),t.Q6J("ngIf",e.setupProgress),t.xp6(1),t.Q6J("disabled",e.setupLoading||e.userForm.invalid)}}let w=(()=>{class s{constructor(e,n,r,g){this.helper=e,this.apiService=n,this.fb=r,this.router=g,this.page="deps",this.setupLoading=!1,this.setupProgress="",this.testingDbConnection=!1,this.dbError="",this.dbMsg="",this.checkingDeps=!1}ngOnInit(){this.depsCheck(),this.prepareDatabaseForm(),this.prepareUserForm()}prepareDatabaseForm(){this.dbForm=this.fb.group({host:["gfdatabase",[o.kI.required]],username:["root",[o.kI.required]],password:["root",[]],database:["gf",[o.kI.required]],port:["3306",[o.kI.required]],socket:["",[]]})}prepareUserForm(){this.userForm=this.fb.group({email:["asd@asd.com",[o.kI.email,o.kI.required]],password:["asdasdasd",[o.kI.required,o.kI.minLength(3)]],confirm_password:["asdasdasd",[o.kI.required,o.kI.minLength(3)]],public_domain:[window.location.origin,[o.kI.required]]})}setupSubmit(){if(this.userForm.invalid)return void this.userForm.markAllAsTouched();let e=this.userForm.value;e.password==e.confirm_password?(this.setupProgress="Creating config file",this.setupLoading=!0,this.userForm.disable(),this.apiService.post("auth/save-setup",{user:this.userForm.value,database:this.dbForm.value}).subscribe({next:n=>{n.status?(this.setupProgress="Running database Migrate",this.apiService.post("auth/init-setup",{user:this.userForm.value}).subscribe({next:r=>{r.status?(this.setupProgress="Creating admin user",setTimeout(()=>{this.router.navigate(["/"])},1e3),this.setupLoading=!1):(this.userForm.enable(),this.setupProgress="",this.setupLoading=!1,this.helper.alert({message:r.message,exception:r.exception,type:"error"}))},error:r=>{this.userForm.enable(),this.setupProgress="",this.setupLoading=!1,this.helper.alert({message:r,type:"error"})}})):(this.userForm.enable(),this.setupProgress="",this.setupLoading=!1,this.helper.alert({message:n.message,exception:n.exception,type:"error"}))},error:n=>{this.userForm.enable(),this.setupProgress="",this.setupLoading=!1,this.helper.alert({message:n,type:"error"})}})):this.helper.alert({message:"The password does not match, please try again",type:"error"})}testDbConnection(){this.dbForm.invalid?this.dbForm?.markAllAsTouched():(this.testingDbConnection=!0,this.dbError="",this.dbMsg="",this.apiService.post("auth/db-test",this.dbForm?.value).subscribe({next:e=>{e.status?(setTimeout(()=>{this.testingDbConnection=!1,this.page="user"},1e3),this.dbMsg="Successfully connected to mysql server",this.dbForm.disable()):(this.testingDbConnection=!1,this.helper.alert({message:e.message,exception:e.exception,type:"error"}))},error:e=>{this.testingDbConnection=!1,this.helper.alert({message:"Network error",type:"error"})}}))}depsCheck(){this.checkingDeps=!0,this.apiService.post("auth/deps",{}).subscribe({next:e=>{this.checkingDeps=!1,e.status?this.deps=e.data:this.helper.alert({message:e.message,type:"Error"})},error:e=>{this.checkingDeps=!1,this.helper.alert({message:e,type:"error"})}})}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(f.W),t.Y36(h.s),t.Y36(o.qu),t.Y36(l.F0))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-setup"]],decls:10,vars:3,consts:[[1,"lc"],[1,"l"],["src","assets/logo.png","alt","",1,"logo"],[1,"head-t"],["class","l",4,"ngIf"],[4,"ngIf"],["type","button","color","primary","mat-flat-button","",3,"click",4,"ngIf"],["type","button","color","primary","mat-flat-button","",3,"click"],[2,"height","10px"],[2,"width","500px",3,"formGroup","submit"],["appearance","outline",1,"mr2"],["matInput","","formControlName","host"],["matInput","","formControlName","database"],["matInput","","formControlName","username"],["matInput","","formControlName","password"],["matInput","","formControlName","port"],["matInput","","formControlName","socket"],["style","color: forestgreen;\n                  margin-top: 0;\n                  margin-bottom: 21px;",4,"ngIf"],["type","submit","color","primary","mat-flat-button","",3,"disabled"],[2,"color","forestgreen","margin-top","0","margin-bottom","21px"],["appearance","outline",1,"mr2",2,"width","300px"],["matInput","","formControlName","email"],["matInput","","formControlName","confirm_password"],["appearance","outline",1,"mr2",2,"width","350px"],["matInput","","formControlName","public_domain"],["style","color: black;\n                  margin-top: 0;\n                  margin-bottom: 21px;",4,"ngIf"],[2,"color","black","margin-top","0","margin-bottom","21px"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t._UZ(2,"img",2),t.TgZ(3,"h1",3),t._uU(4,"Welcome to Gitftp"),t.qZA(),t.TgZ(5,"p"),t._uU(6," no .env file is present, setup will continue. "),t.qZA()(),t.YNc(7,v,11,5,"div",4),t.YNc(8,q,37,4,"div",4),t.YNc(9,P,29,3,"div",4),t.qZA()),2&e&&(t.xp6(7),t.Q6J("ngIf","deps"==n.page),t.xp6(1),t.Q6J("ngIf",n.deps&&n.deps.status&&"db"==n.page),t.xp6(1),t.Q6J("ngIf",n.deps&&n.deps.status&&"user"==n.page))},dependencies:[d.O5,u.lW,o._Y,o.Fj,o.JJ,o.JL,o.sg,o.u,p.KE,p.hX,m.Nt],styles:[".lc[_ngcontent-%COMP%]{width:100%}.lc[_ngcontent-%COMP%]   .l[_ngcontent-%COMP%]{margin:55px}.lc[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{height:50px;margin-bottom:10px;margin-left:-10px}.lc[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   .head-t[_ngcontent-%COMP%]{margin:0;font-weight:400}"]}),s})();var F=a(7392),y=a(3546);let S=[{path:"login",component:_},{path:"setup",component:w}],M=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[d.ez,l.Bz.forChild(S),y.QW,u.ot,o.u5,o.UX,p.lN,m.c,F.Ps]}),s})()}}]);