"use strict";(self.webpackChunkng=self.webpackChunkng||[]).push([[328],{8328:(G,T,i)=>{i.r(T),i.d(T,{ServerCreateModule:()=>D});var c=i(6895),l=i(4006),d=i(5412),t=i(4650),b=i(1458),y=i(1491),u=i(4859),m=i(9549),g=i(4144),v=i(7392),U=i(1572),Z=i(266);function q(r,a){1&r&&(t.TgZ(0,"mat-icon"),t._uU(1,"folder"),t.qZA())}function J(r,a){1&r&&(t.TgZ(0,"mat-icon"),t._uU(1,"insert_drive_file"),t.qZA())}function B(r,a){if(1&r){const e=t.EpF();t.TgZ(0,"div",15),t.NdJ("click",function(){const n=t.CHM(e).$implicit,p=t.oxw();return t.KtG(p.gotoPath(n))}),t.YNc(1,q,2,0,"mat-icon",16),t.YNc(2,J,2,0,"mat-icon",16),t.TgZ(3,"span",13),t._uU(4),t.qZA(),t.TgZ(5,"span",17),t._uU(6),t.qZA()()}if(2&r){const e=a.$implicit;t.Gre("f ",e.type,""),t.xp6(1),t.Q6J("ngIf","dir"==e.type),t.xp6(1),t.Q6J("ngIf","file"==e.type),t.xp6(2),t.hij(" ",e.path," "),t.xp6(2),t.hij(" ",e.file_size," ")}}const w=function(r){return{hide:r}};let O=(()=>{class r{constructor(e,o,s,n){this.helper=e,this.apiService=o,this.dialogRef=s,this.data=n,this.path="",this.projectId="",this.files=[],this.error="",this.calling=!1,this.projRoot=!1,this.message="",this.server=this.data.server,this.path=this.server.path,this.projectId=this.data.project_id}ngOnInit(){this.call()}submit(){this.dialogRef.close(this.path)}callT(){this.callTI&&(clearTimeout(this.callTI),this.callTI=!1),this.callTI=setTimeout(()=>{this.call()},400)}gotoPath(e){"dir"==e.type&&(this.path=e.path,this.call())}goBack(){let e="../";this.path&&("/"!=this.path.charAt(this.path.length-1)&&(this.path+="/"),console.log(this.path),"../"==this.path.substring(this.path.length-3)?e=this.path+e:("/"==this.path.charAt(this.path.length-1)&&(e=this.path.substring(0,this.path.length-1)),e=e.substring(0,e.lastIndexOf("/")+1))),this.path=e}call(e=!1,o=!1){this.error="";let s=Object.assign({},this.server);s.path=this.path,this.calling=!0,!e||o?(this.projRoot=!1,this.message="",this.apiService.post("server/test",{payload:s,write_test:e,project_id:this.projectId}).subscribe({next:n=>{this.calling=!1,console.log(n),n.status?(this.message=n.message,this.files=n.data.list.map(p=>(-1!=p.path.indexOf("gitftp.md")&&(this.projRoot=!0),p.file_size=this.helper.bytes(p.file_size,1),p))):this.error=n.message},error:n=>{this.calling=!1,this.helper.alertError(n)}})):this.helper.alert({message:"Gitftp will attempt to write & delete gitftp-write-test.txt file on this path",type:"alert",buttons:["Close","Confirm"]}).afterClosed().subscribe({next:p=>{"Confirm"==p&&this.call(!0,!0)}})}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(b.W),t.Y36(y.s),t.Y36(d.so),t.Y36(d.WI))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-browse-server"]],decls:26,vars:11,consts:[[2,"padding-top","0px"],[1,"bootstrap-wrapper",2,"padding","0px 6px 10px","min-width","800px","position","relative"],[1,"container",2,"position","sticky","padding-top","25px","top","0","z-index","2","background-color","white"],[1,"row"],[1,"col-12"],[2,"margin-top","0px"],["appearance","outline"],["matPrefix","","diameter","20",2,"width","50px","padding-left","5px",3,"ngClass"],["matInput","","placeholder","Type path",2,"font-family","'Lucida Console', monospace, sans-serif",3,"ngModel","keyup.enter","input","ngModelChange"],["matSuffix","","type","button","mat-icon-button","","matTooltip","Select path","color","primary",2,"margin-right","5px",3,"click"],["type","button","mat-stroked-button","","color","primary",2,"float","right","margin-top","-13px",3,"click"],[1,"container"],[1,"f","dir",3,"click"],[1,"fp"],[3,"class","click",4,"ngFor","ngForOf"],[3,"click"],[4,"ngIf"],[1,"fs"]],template:function(e,o){1&e&&(t.TgZ(0,"mat-dialog-content",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h2",5),t._uU(6," Locate deploy path "),t.qZA(),t.TgZ(7,"mat-form-field",6),t._UZ(8,"mat-spinner",7),t.TgZ(9,"input",8),t.NdJ("keyup.enter",function(){return o.submit()})("input",function(){return o.callT()})("ngModelChange",function(n){return o.path=n}),t.qZA(),t.TgZ(10,"button",9),t.NdJ("click",function(){return o.submit()}),t.TgZ(11,"mat-icon"),t._uU(12,"check"),t.qZA()()(),t.TgZ(13,"button",10),t.NdJ("click",function(){return o.call(!0)}),t._uU(14," Test write permission "),t.qZA(),t.TgZ(15,"p"),t._uU(16),t.qZA()()()(),t.TgZ(17,"div",11)(18,"div",3)(19,"div",4)(20,"div",12),t.NdJ("click",function(){return o.goBack(),o.call()}),t.TgZ(21,"mat-icon"),t._uU(22,"arrow_upward"),t.qZA(),t.TgZ(23,"span",13),t._uU(24,"\n../ [Navigate up] "),t.qZA()(),t.YNc(25,B,7,7,"div",14),t.qZA()()()()()),2&e&&(t.xp6(8),t.Q6J("ngClass",t.VKq(9,w,!o.calling)),t.xp6(1),t.Q6J("ngModel",o.path),t.xp6(6),t.Jzz("margin-top: 0px;color: ",o.error?"orangered":"",""),t.xp6(1),t.lnq("",o.message," ",o.error,"\xa0 ",o.projRoot?"This is the Gitftp installation dir, Navigate up to get parent directories":"",""),t.xp6(9),t.Q6J("ngForOf",o.files))},dependencies:[c.mk,c.sg,c.O5,u.lW,u.RK,l.Fj,l.JJ,l.On,m.KE,m.qo,m.R9,g.Nt,v.Hw,U.Ou,d.xY,Z.gM],styles:[".f[_ngcontent-%COMP%]{padding:6px 17px 5px;background-color:#fff;border-radius:4px;transition:background-color .3s;opacity:.5}.f[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#444;margin-right:14px}.f[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{vertical-align:middle}.f.dir[_ngcontent-%COMP%]{cursor:pointer;opacity:1}.f[_ngcontent-%COMP%]   .fs[_ngcontent-%COMP%]{float:right;margin-top:5px}.f[_ngcontent-%COMP%]:hover{background-color:#add8e6}.hide[_ngcontent-%COMP%]{opacity:0}"]}),r})();var C=i(9299),x=i(3238),A=i(4385),S=i(6709),_=i(1948),I=i(455);function M(r,a){if(1&r&&(t.TgZ(0,"mat-option",31),t._uU(1),t.qZA()),2&r){const e=a.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e)}}function P(r,a){1&r&&(t.TgZ(0,"div",18)(1,"mat-checkbox",32),t._uU(2," Use FTP over TLS (FTPS) (recommended) "),t.qZA()())}function Y(r,a){1&r&&(t.TgZ(0,"div",7)(1,"mat-form-field",14)(2,"mat-label"),t._uU(3,"Host"),t.qZA(),t._UZ(4,"input",33),t.qZA()())}function k(r,a){1&r&&(t.TgZ(0,"div",7)(1,"mat-form-field",14)(2,"mat-label"),t._uU(3,"Port"),t.qZA(),t._UZ(4,"input",34),t.qZA()())}function F(r,a){1&r&&(t.TgZ(0,"div",7)(1,"mat-form-field",14)(2,"mat-label"),t._uU(3,"Username"),t.qZA(),t._UZ(4,"input",35),t.qZA()())}function Q(r,a){1&r&&(t.TgZ(0,"div",7)(1,"mat-form-field",14)(2,"mat-label"),t._uU(3,"Password"),t.qZA(),t._UZ(4,"input",36),t.qZA()())}function R(r,a){1&r&&(t.TgZ(0,"div",18)(1,"mat-slide-toggle",37),t._uU(2,"Use public key for authentication "),t.qZA()())}let N=(()=>{class r{constructor(e,o,s,n,p,h){this.apiService=e,this.helper=o,this.activatedRoute=s,this.fb=n,this.dialog=p,this.router=h,this.projectId="",this.serverId="",this.loading=!1,this.saving=!1,this.branches=[],this.gettingBranches=!1,this.form=this.fb.group({server_name:["",[l.kI.required]],branch:["",[l.kI.required]],type:["local",[l.kI.required]],secure:["",[]],host:["",[]],port:["",[]],username:["",[]],password:["",[]],path:["",[]],key_id:["",[]],auto_deploy:["",[]],revision:["",[]]})}encode(e){return this.helper.encode(e)}set setChildData(e){this.projectId=e.projectId,this.project=e.project,this.helper.setPage("project"+this.projectId+"servers"),this.getBranches(),this.activatedRoute.params.subscribe(o=>{this.serverId=this.helper.decode(o.id),this.load()})}load(){this.loading=!0,this.apiService.post("servers/list",{server_id:this.serverId,project_id:this.projectId}).subscribe({next:e=>{console.log(e),e.status?this.form.patchValue(e.data.servers[0]):this.helper.alertError(e)},error:e=>{this.helper.alertError(e)}})}save(){this.saving=!0,this.apiService.post("server/save",{project_id:this.projectId,server_id:this.serverId,payload:this.form.value}).subscribe({next:e=>{this.saving=!1,console.log(e),e.status?this.router.navigate(["project",this.helper.encode(this.projectId),"servers"]):this.helper.alertError(e)},error:e=>{this.saving=!1,this.helper.alertError(e)}})}ngOnInit(){}getBranches(){this.gettingBranches=!0,console.log(this.projectId),this.apiService.post("repo/git/branches",{project_id:this.projectId}).subscribe({next:e=>{this.gettingBranches=!1,console.log(e),e.status?this.branches=e.data.branches:this.helper.alertError(e)},error:e=>{this.gettingBranches=!1,this.helper.alertError(e)}})}browseDir(){this.dialog.open(O,{data:{server:this.form.value}}).afterClosed().subscribe({next:e=>{e&&this.form.get("path")?.setValue(e)}})}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(y.s),t.Y36(b.W),t.Y36(C.gz),t.Y36(l.qu),t.Y36(d.uw),t.Y36(C.F0))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-server-create"]],decls:79,vars:13,consts:[[1,"page","bootstrap-wrapper"],[1,"header",2,"margin-bottom","0"],[1,"btns"],[3,"formGroup","submit"],[2,"margin-top","10px"],[1,"container"],[1,"row"],[1,"col-6"],[1,"col-3"],["appearance","outline",1,"mr2"],["matInput","","formControlName","server_name"],["formControlName","branch",3,"disabled"],[3,"value",4,"ngFor","ngForOf"],[1,"col-4"],["appearance","outline"],["matInput","","placeholder","SHA hash","formControlName","revision"],["formControlName","auto_deploy",2,"margin-top","-4px"],[2,"margin-top","30px"],[1,"col-12"],[2,"margin-bottom","10px"],["aria-label","Select an option","formControlName","type"],["value","ftp",2,"margin-right","20px"],["value","sftp",2,"margin-right","20px"],["value","local",2,"margin-right","20px"],[1,"col-7"],["class","col-12",4,"ngIf"],["class","col-6",4,"ngIf"],["matInput","","placeholder","../path/to/htdocs/","formControlName","path"],["matSuffix","","mat-icon-button","","type","button","matTooltip","Browse server","aria-label","Clear",2,"margin-right","5px",3,"click"],["type","submit","mat-flat-button","","color","primary"],[2,"height","200px"],[3,"value"],["formControlName","secure",2,"margin-bottom","15px"],["matInput","","formControlName","host"],["matInput","","formControlName","port"],["matInput","","formControlName","username"],["matInput","","formControlName","password"],["formControlName","password",2,"margin-bottom","20px"]],template:function(e,o){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h2"),t._uU(3),t.qZA(),t._UZ(4,"div",2),t.qZA(),t.TgZ(5,"form",3),t.NdJ("submit",function(){return o.save()}),t.TgZ(6,"div",4)(7,"div",5)(8,"div",6)(9,"div",7)(10,"h3")(11,"span"),t._uU(12,"Environment details"),t.qZA()()()(),t.TgZ(13,"div",6)(14,"div",8)(15,"mat-form-field",9)(16,"mat-label"),t._uU(17,"Server name"),t.qZA(),t._UZ(18,"input",10),t.qZA()(),t.TgZ(19,"div",8)(20,"mat-form-field",9)(21,"mat-label"),t._uU(22,"Branch to deploy"),t.qZA(),t.TgZ(23,"mat-select",11),t.YNc(24,M,2,2,"mat-option",12),t.qZA()()()(),t.TgZ(25,"div",6)(26,"div",13)(27,"mat-form-field",14)(28,"mat-label"),t._uU(29,"Current revision"),t.qZA(),t._UZ(30,"input",15),t.TgZ(31,"mat-hint"),t._uU(32,"Leave empty if fresh upload"),t.qZA()()(),t.TgZ(33,"div",8)(34,"mat-checkbox",16),t._uU(35," Continuous deployment "),t._UZ(36,"br"),t.TgZ(37,"mat-hint"),t._uU(38,"Deploy will be triggered when commits are pushed to repository"),t.qZA()(),t._UZ(39,"div"),t.qZA()()(),t.TgZ(40,"div",5)(41,"div",6)(42,"div",7)(43,"h3",17)(44,"span"),t._uU(45,"Server connection"),t.qZA()()()(),t.TgZ(46,"div",6)(47,"div",18)(48,"div",19)(49,"mat-radio-group",20)(50,"mat-radio-button",21),t._uU(51,"FTP "),t.qZA(),t.TgZ(52,"mat-radio-button",22),t._uU(53,"SFTP "),t.qZA(),t.TgZ(54,"mat-radio-button",23),t._uU(55,"Local "),t.qZA()()()()(),t.TgZ(56,"div",6)(57,"div",24)(58,"div",6),t.YNc(59,P,3,0,"div",25),t.YNc(60,Y,5,0,"div",26),t.YNc(61,k,5,0,"div",26),t.YNc(62,F,5,0,"div",26),t.YNc(63,Q,5,0,"div",26),t.YNc(64,R,3,0,"div",25),t.qZA()(),t.TgZ(65,"div",7)(66,"mat-form-field",14)(67,"mat-label"),t._uU(68,"Deploy path"),t.qZA(),t._UZ(69,"input",27),t.TgZ(70,"button",28),t.NdJ("click",function(){return o.browseDir()}),t.TgZ(71,"mat-icon"),t._uU(72,"folder_open"),t.qZA()()()(),t.TgZ(73,"div",18)(74,"button",29),t._uU(75," Save "),t.qZA()()()()()()(),t._UZ(76,"div",30),t._uU(77),t.ALo(78,"json")),2&e){let s,n,p,h,f,j;t.xp6(3),t.hij(" ",o.serverId?"Update":"Create"," server"),t.xp6(2),t.Q6J("formGroup",o.form),t.xp6(18),t.Q6J("disabled",o.gettingBranches),t.xp6(1),t.Q6J("ngForOf",o.branches),t.xp6(35),t.Q6J("ngIf","ftp"==(null==(s=o.form.get("type"))?null:s.value)),t.xp6(1),t.Q6J("ngIf","ftp"==(null==(n=o.form.get("type"))?null:n.value)||"sftp"==(null==(n=o.form.get("type"))?null:n.value)),t.xp6(1),t.Q6J("ngIf","ftp"==(null==(p=o.form.get("type"))?null:p.value)||"sftp"==(null==(p=o.form.get("type"))?null:p.value)),t.xp6(1),t.Q6J("ngIf","ftp"==(null==(h=o.form.get("type"))?null:h.value)||"sftp"==(null==(h=o.form.get("type"))?null:h.value)),t.xp6(1),t.Q6J("ngIf","ftp"==(null==(f=o.form.get("type"))?null:f.value)||"sftp"==(null==(f=o.form.get("type"))?null:f.value)),t.xp6(1),t.Q6J("ngIf","sftp"==(null==(j=o.form.get("type"))?null:j.value)),t.xp6(13),t.hij("\n",t.lcZ(78,11,o.form.value),"\n")}},dependencies:[c.sg,c.O5,u.lW,u.RK,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,m.KE,m.hX,m.bx,m.R9,g.Nt,v.Hw,x.ey,A.gD,S.oG,_.VQ,_.U0,Z.gM,I.Rr,c.Ts]}),r})();var E=i(3546),z=i(7155);let L=[{path:"add",component:N},{path:"setup/:id",component:N}],D=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[c.ez,C.Bz.forChild(L),E.QW,u.ot,l.u5,l.UX,m.lN,g.c,v.Ps,x.Ng,A.LD,U.Cq,d.Is,z.p0,S.p9,_.Fk,Z.AV,I.rP]}),r})()}}]);