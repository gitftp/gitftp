"use strict";(self.webpackChunkng=self.webpackChunkng||[]).push([[614],{2614:(Q,c,i)=>{i.r(c),i.d(c,{DeployModule:()=>F});var a=i(6895),n=i(4006),t=i(4650),T=i(1458),b=i(1491),h=i(9299),g=i(4859),m=i(9549),d=i(7331),v=i(7392),f=i(3238),u=i(4385),y=i(2993),C=i(1572);function A(o,l){if(1&o&&(t.TgZ(0,"mat-option",21),t._uU(1),t.qZA()),2&o){const e=l.$implicit;t.Q6J("value",e.server_id),t.xp6(1),t.hij(" ",e.server_name," ")}}function D(o,l){1&o&&(t.TgZ(0,"div",27),t._UZ(1,"mat-spinner",28),t.qZA())}function U(o,l){if(1&o&&(t.TgZ(0,"div",29)(1,"div",30),t._uU(2),t.ALo(3,"slice"),t.qZA(),t.TgZ(4,"div",31),t._uU(5),t.qZA(),t.TgZ(6,"div",32),t._UZ(7,"img",33),t.TgZ(8,"span"),t._uU(9),t.qZA(),t.TgZ(10,"span",34),t._uU(11),t.ALo(12,"lowercase"),t.ALo(13,"date"),t.qZA()()()),2&o){const e=t.oxw(2);t.xp6(2),t.hij(" ",t.Dn7(3,5,e.latestCommits[0].sha,0,8)," "),t.xp6(3),t.hij(" ",e.latestCommits[0].message," "),t.xp6(2),t.Q6J("src",e.latestCommits[0].author_avatar,t.LSH),t.xp6(2),t.hij(" ",e.latestCommits[0].author," "),t.xp6(2),t.hij(" committed ",t.lcZ(12,9,t.xi3(13,11,e.latestCommits[0].time,"medium"))," ")}}function j(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"div",11)(1,"div",18)(2,"p")(3,"mat-icon",22),t._uU(4,"info"),t.qZA(),t.TgZ(5,"span",23),t._uU(6," All project files will be uploaded to the server. Files will be updated if they already exists. "),t.qZA()()(),t.TgZ(7,"div",12)(8,"mat-label"),t._uU(9," Revision to be deployed "),t.qZA(),t.YNc(10,D,2,0,"div",24),t.YNc(11,U,14,14,"div",25),t.TgZ(12,"button",26),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.freshDeploy())}),t._uU(13," Deploy "),t.qZA()()()}if(2&o){const e=t.oxw();t.xp6(10),t.Q6J("ngIf",e.loadingLatestCommit),t.xp6(1),t.Q6J("ngIf",e.latestCommits.length&&!e.loadingLatestCommit)}}let x=(()=>{class o{constructor(e,s,r,p){this.helper=e,this.apiService=s,this.fb=r,this.activatedRoutes=p,this.projectId="",this.serverId="",this.servers=[],this.gettingServers=!1,this.type="",this.latestCommits=[],this.loadingLatestCommit=!1,this.deploying=!1,this.form=this.fb.group({server_id:["",[n.kI.required]],type:["",[n.kI.required]]})}set setChildData(e){this.projectId=e.projectId,this.project=e.project,this.helper.setPage("project"+this.projectId+"servers"),this.activatedRoutes.params.subscribe({next:s=>{let r=this.helper.decode(s.id);this.serverId=r,this.form.get("server_id")?.setValue(parseInt(this.serverId)),this.onChangeType()}}),this.getServers()}getServers(){this.gettingServers=!0,this.apiService.post("servers/list",{project_id:this.projectId}).subscribe({next:e=>{this.gettingServers=!1,e.status?(this.servers=e.data.servers,console.log(this.servers,e)):this.helper.alertError(e)},error:e=>{this.gettingServers=!1,this.helper.alertError(e)}})}ngOnInit(){this.form.get("type")?.valueChanges.subscribe(e=>{this.onChangeType()})}getSelectedBranch(){let s,e=this.form.get("server_id")?.value;for(let r of this.servers)if(r.server_id==e){s=r;break}return s}onChangeType(e=!1){this.form.get("type")?.value==this.type&&!e||("fresh"==this.form.get("type")?.value&&this.getLatestCommit(),this.form.get("type"),this.type=this.form.get("type")?.value)}getLatestCommit(){this.loadingLatestCommit=!0,this.apiService.post("repo/git/commits",{project_id:this.projectId,branch:this.getSelectedBranch()?.branch}).subscribe({next:e=>{this.loadingLatestCommit=!1,console.log(e),e.status?this.latestCommits=e.data.commits:this.helper.alertError(e.message)},error:e=>{this.loadingLatestCommit=!1,this.helper.alertError(e)}})}freshDeploy(){this.deploying=!0,this.apiService.post("deploy",{project_id:this.projectId,server_id:this.serverId,deploy_type:this.type,revision:this.latestCommits[0].sha}).subscribe({next:e=>{console.log(e),this.deploying=!1,e.status||this.helper.alertError(e)},error:e=>{this.deploying=!1,this.helper.alertError(e)}})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(T.W),t.Y36(b.s),t.Y36(n.qu),t.Y36(h.gz))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-deploy"]],decls:34,vars:10,consts:[[1,"page","bootstrap-wrapper"],[3,"formGroup"],[1,"header",2,"margin-bottom","0"],[1,"field-nude",2,"width","500px","margin-left","-7px"],["formControlName","server_id","placeholder","[select]",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],[2,"display","block","margin-top","-30px"],["name","ionGitBranch",2,"font-size","21px","vertical-align","middle"],[1,"btns"],[2,"margin-top","10px"],[1,"container"],[1,"row"],[1,"col-6"],[1,"no-m-t"],[1,"col-3"],["aria-label","Fish selection","formControlName","type"],["value","deploy",3,"disabled"],["value","fresh",3,"disabled"],[1,"col-12"],["class","row",4,"ngIf"],[2,"height","200px"],[3,"value"],[1,"vm","muted2"],[1,"vm"],["style","padding: 20px 0;",4,"ngIf"],["class","commit",4,"ngIf"],["type","submit","mat-flat-button","","btn-big","","color","primary",3,"click"],[2,"padding","20px 0"],["diameter","30"],[1,"commit"],[1,"sha","c"],[1,"m"],[1,"mc"],["alt","",3,"src"],[2,"color","#888"]],template:function(e,s){if(1&e&&(t.TgZ(0,"div",0)(1,"form",1)(2,"div",2)(3,"h2"),t._uU(4," Deploy to "),t.TgZ(5,"mat-form-field",3)(6,"mat-select",4),t.NdJ("selectionChange",function(){return s.onChangeType(!0)}),t.YNc(7,A,2,2,"mat-option",5),t.qZA()()(),t.TgZ(8,"div",6),t._uU(9," from "),t._UZ(10,"ng-icon",7),t.TgZ(11,"strong"),t._uU(12),t.qZA()(),t._UZ(13,"div",8),t.qZA()(),t.TgZ(14,"div",9)(15,"div",10)(16,"div",11)(17,"div",12)(18,"h3",13)(19,"span"),t._uU(20,"Deployment type"),t.qZA()()()(),t.TgZ(21,"div",11)(22,"div",14)(23,"form",1)(24,"mat-chip-listbox",15)(25,"mat-chip-option",16),t._uU(26,"Deploy "),t.qZA(),t.TgZ(27,"mat-chip-option",17),t._uU(28,"Fresh upload "),t.qZA()()()(),t.TgZ(29,"div",18),t.YNc(30,j,14,2,"div",19),t.qZA()()()()(),t._UZ(31,"div",20),t._uU(32),t.ALo(33,"json")),2&e){let r,p,Z;t.xp6(1),t.Q6J("formGroup",s.form),t.xp6(6),t.Q6J("ngForOf",s.servers),t.xp6(5),t.hij(" ",null==(r=s.getSelectedBranch())?null:r.branch," "),t.xp6(11),t.Q6J("formGroup",s.form),t.xp6(2),t.Q6J("disabled","deploy"==(null==(p=s.form.get("type"))?null:p.value)),t.xp6(2),t.Q6J("disabled","fresh"==(null==(Z=s.form.get("type"))?null:Z.value)),t.xp6(3),t.Q6J("ngIf","fresh"==s.form.value.type),t.xp6(2),t.hij("\n",t.lcZ(33,8,s.form.value),"\n")}},dependencies:[a.sg,a.O5,n._Y,n.JJ,n.JL,g.lW,m.KE,m.hX,d.z2,d.iO,v.Hw,f.ey,u.gD,n.sg,n.u,y.Fv,C.Ou,a.i8,a.Ts,a.OU,a.uU],styles:[".mdc-evolution-chip-set[_ngcontent-%COMP%]{margin-bottom:15px}.commit[_ngcontent-%COMP%]{border:solid 1px #ddd;margin:10px 0 20px;position:relative;background-color:#f8f8ff;border-radius:6px;padding:10px 15px}.commit[_ngcontent-%COMP%]   .m[_ngcontent-%COMP%]{font-weight:700;margin-bottom:5px}.commit[_ngcontent-%COMP%]   .mc[_ngcontent-%COMP%]{vertical-align:middle}.commit[_ngcontent-%COMP%]   .mc[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{vertical-align:middle}.commit[_ngcontent-%COMP%]   .mc[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:24px;border-radius:50px}.commit[_ngcontent-%COMP%]   .sha[_ngcontent-%COMP%]{float:right;color:#1e90ff;padding:1px 10px;border-radius:6px;margin-top:-1px;font-size:14px}"]}),o})();var I=i(6709),O=i(4144),M=i(1948),P=i(455),J=i(266),L=i(3546);let S=[{path:"",component:x},{path:":id",component:x}],F=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[a.ez,h.Bz.forChild(S),n.u5,g.ot,I.p9,m.lN,d.Hi,v.Ps,O.c,f.Ng,M.Fk,u.LD,P.rP,J.AV,n.UX,y.Fv,C.Cq,L.QW]}),o})()}}]);